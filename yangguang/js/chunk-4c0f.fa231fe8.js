(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c0f"],{"08f3":function(t,e,i){},"9f86":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",[i("div",{staticClass:"search-con search-con-top"},[i("Select",{staticClass:"search-col",attrs:{placeholder:"请选择搜索字段",clearable:""},on:{"on-clear":t.searchKeyChange,"on-change":t.searchKeyChange},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}},t._l([{key:"nm_title",title:"标题"},{key:"nm_isdraft",title:"状态"}],function(e){return i("Option",{key:"search-col-"+e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])})),"nm_title"===t.searchKey?i("Input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"输入标题关键字搜索"},model:{value:t.nm_title,callback:function(e){t.nm_title=e},expression:"nm_title"}}):t._e(),"nm_isdraft"===t.searchKey?i("Select",{staticClass:"search-col",staticStyle:{"margin-left":"2px"},attrs:{clearable:"",placeholder:"请选择公告状态"},model:{value:t.nm_isdraft,callback:function(e){t.nm_isdraft=e},expression:"nm_isdraft"}},t._l([{key:!0,title:"已保存"},{key:!1,title:"已发布"}],function(e){return i("Option",{key:"search-col-"+e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])})):t._e(),i("Button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.getNotifyList}},[i("Icon",{attrs:{type:"search"}}),t._v("搜索")],1),t._l(t.permissionBtns,function(e){return 30===e.p_id?i("Button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v(t._s(e.p_name))]):t._e()})],2),i("Table",{ref:"tablesMain",attrs:{data:t.tableData,columns:t.columns}}),i("Page",{staticClass:"page",attrs:{total:t.total,"page-size":t.pageSize,"show-sizer":"","show-elevator":"","prev-text":"上一页","next-text":"下一页"},on:{"on-change":t.pageOnChange,"on-page-size-change":t.onPageSizeChange}}),i("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{action:"http://47.106.109.254:8090/m/uploadImage.do",headers:t.header,name:"image","on-success":t.handleSuccess,"before-upload":t.handleBeforeUpload,"on-format-error":t.handleFormatError}},[i("Button",{attrs:{id:"upLoadImg",icon:"ios-cloud-upload-outline"}},[t._v("Upload files")])],1)],1),i("Modal",{attrs:{width:"800","mask-closable":!1},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[i("p",{staticStyle:{color:"#2d8cf0"},attrs:{slot:"header"},slot:"header"},[i("span",[t._v(t._s(t.modalTitle))])]),i("Form",[i("FormItem",[i("label",[t._v("标题：")]),i("Input",{attrs:{placeholder:"请输入公告标题"},model:{value:t.nmTitle,callback:function(e){t.nmTitle=e},expression:"nmTitle"}})],1),i("FormItem",[i("label",[t._v("关键字：")]),i("Input",{attrs:{placeholder:"请输入公告关键字"},model:{value:t.nmKeys,callback:function(e){t.nmKeys=e},expression:"nmKeys"}})],1),i("FormItem",[i("label",[t._v("内容：")]),i("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOptions,content:t.nmContent},model:{value:t.nmContent,callback:function(e){t.nmContent=e},expression:"nmContent"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[t.isView||t.isEdit?t._e():i("Button",{attrs:{type:"info",size:"large"},on:{click:t.addNotify}},[t._v("保存")]),t.isEdit?i("Button",{attrs:{type:"info",size:"large"},on:{click:t.editNotify}},[t._v("修改")]):t._e()],1)],1)],1)},o=[],a=(i("ac4d"),i("8a81"),i("ac6a"),i("ebad")),s=i("66df"),l=i("c276"),r=i("88ec"),c={name:"notify_message_page",components:{QuillEditor:a["a"]},data:function(){var t=this;return{nm_title:"",nm_isdraft:null,columns:[{title:"标题",align:"center",key:"nm_title",sortable:!0},{title:"创建人",align:"center",key:"username"},{title:"状态",align:"center",key:"nm_isdraft",editable:!0,render:function(t,e){return e.row.nm_isdraft?t("div","已保存"):t("div","已发布")}},{title:"操作",key:"handle",align:"center",render:function(e,i){for(var n=[],o=function(){var o=t.handleBtns[a];31===o.p_id?n.push(e("Button",{props:{type:"primary",size:"small",disabled:!i.row.nm_isdraft||5===i.row.data_level},style:{margin:"2px"},on:{click:function(){t.showOneNotify(t.showOneNotifyPath,i.row.nm_id),t.showModal=!0,t.modalTitle="机构公告修改",t.isView=!1,t.isEdit=!0,t.editId=i.row.nm_id}}},"修改")):32===o.p_id?n.push(e("Button",{props:{type:"info",size:"small"},style:{margin:"2px"},on:{click:function(){t.showOneNotify(o.p_path,i.row.nm_id),t.showModal=!0,t.modalTitle="机构公告查看",t.isView=!0,t.isEdit=!1}}},"查看")):33===o.p_id?n.push(e("Button",{props:{type:"error",size:"small",disabled:5===i.row.data_level||!i.row.nm_isdraft},style:{margin:"2px"},on:{click:function(){t.deleteNotify(o.p_path,i.row.nm_id)}}},"删除")):34===o.p_id?n.push(e("Button",{props:{type:"warning",size:"small",disabled:1===i.row.data_level},style:{margin:"2px"},on:{click:function(){t.restoreRole(o.p_path,i.row.nm_id)}}},"恢复")):35===o.p_id?n.push(e("Button",{props:{type:"success",size:"small",disabled:!i.row.nm_isdraft||5===i.row.data_level},style:{margin:"2px"},on:{click:function(){t.publicNotify(o.p_path,i.row.nm_id)}}},"发布")):36===o.p_id&&n.push(e("Button",{props:{type:"default",size:"small",disabled:i.row.nm_isdraft},style:{margin:"2px"},on:{click:function(){t.retracementNotify(o.p_path,i.row.nm_id)}}},"回撤"))},a=0;a<t.handleBtns.length;a++)o();return e("div",n)}}],tableData:[],searchValue:"",searchKey:"",modalTitle:"添加公告",nmTitle:"",nmKeys:"",nmContent:"",showModal:!1,header:{},quill:null,editorOptions:{placeholder:"请输入公告内容…",modules:{toolbar:{placeholder:"请输入会议纪要内容…",container:[["bold","italic","underline","strike","image","clean"],[{header:1},{header:2}],[{color:[]},{background:[]}],[{align:[]}]],handlers:{image:function(t){t?(console.log(t),document.querySelector("#upLoadImg").click()):this.quill.format("image",!1)}}}}},permissionBtns:[],handleBtns:[],isView:!1,isEdit:!1,total:0,pageNum:1,pageSize:20,getListPath:"",showOneNotifyPath:"",editId:""}},methods:{handleAdd:function(){this.showModal=!0,this.isView=!1,this.isEdit=!1,this.modalTitle="添加机构公告"},addNotify:function(){var t=this;s["a"].request({url:"admin/adm/notifyMessage/addEntity.do",data:{nmTitle:t.nmTitle,nmKeys:t.nmKeys,nmContent:t.nmContent},method:"post"}).then(function(e){200===e.data.code?(t.getNotifyList(),t.showModal=!1,t.$Notice.success({title:"公告添加成功"})):t.$Notice.error({title:e.data.msg})})},editNotify:function(){var t=this;s["a"].request({url:"admin/adm/notifyMessage/editEntity.do",data:{nmId:t.editId,nmTitle:t.nmTitle,nmKeys:t.nmKeys,nmContent:t.nmContent,nmIsdraft:!1},method:"post"}).then(function(e){200===e.data.code?(t.getNotifyList(),t.showModal=!1,t.$Notice.success({title:"公告修改成功"})):t.$Notice.error({title:e.data.msg})})},showOneNotify:function(t,e){var i=this;s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){i.nmTitle=t.data.content.nm_title,i.nmKeys=t.data.content.nm_keys,i.nmContent=t.data.content.nm_content})},getNotifyList:function(){var t=this;s["a"].request({url:this.getListPath,data:{pageNum:this.pageNum,pageSize:this.pageSize,isSelf:!0,isDraft:this.nm_isdraft,name:this.nm_title},method:"post"}).then(function(e){if(200===e.status){t.tableData=[],t.total=e.data.content.total;for(var i=0;i<e.data.content.list.length;i++)t.tableData.push(e.data.content.list[i])}else t.$Notice.error({title:e.data.msg})})},deleteNotify:function(t,e){var i=this;this.$Modal.confirm({title:"提示",content:"确认删除该公告？",onOk:function(){s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200===t.data.code?(i.getNotifyList(),i.$Notice.success({title:"删除成功"})):i.$Notice.error({title:t.data.msg})})}})},restoreRole:function(t,e){var i=this;i.$Modal.confirm({title:"提示",content:"确认恢复该公告？",onOk:function(){s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200==t.data.code?(i.$Notice.success({title:"公告信息恢复成功"}),i.getNotifyList()):i.$Notice.error({title:t.data.msg})})}})},publicNotify:function(t,e){var i=this;i.$Modal.confirm({title:"提示",content:"确认发布该公告？",onOk:function(){s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200===t.data.code?(i.getNotifyList(),i.$Notice.success({title:"公告发布成功"})):i.$Notice.error({title:t.data.msg})})}})},retracementNotify:function(t,e){var i=this;i.$Modal.confirm({title:"提示",content:"确认回撤该公告？",onOk:function(){s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200===t.data.code?(i.getNotifyList(),i.$Notice.success({title:"公告回撤成功"})):i.$Notice.error({title:t.data.msg})})}})},handleSuccess:function(t,e){var i=this;if(i.$Spin.hide(),200===t.code&&null!==t.content){var n=i.quill.getSelection().index;i.quill.insertEmbed(n,"image","http://47.106.109.254:8090/"+t.content),i.quill.setSelection(n+1)}else i.$Notice.error({title:t.msg})},handleFormatError:function(){var t=this;t.$Spin.hide(),t.$Notice.error({title:"图片上传失败"})},handleBeforeUpload:function(){this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{type:"ios-loading",size:18}}),t("div","upLoading")])}})},getPermissionBtns:function(){this.permissionBtns=[];var t=!0,e=!1,i=void 0;try{for(var n,o=r["a"].permission[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;a.p_fid===this.$route.meta.id&&(this.permissionBtns.push(a),29===a.p_id&&(this.getListPath=a.p_path),32===a.p_id&&(this.showOneNotifyPath=a.p_path),31!==a.p_id&&32!==a.p_id&&33!==a.p_id&&34!==a.p_id&&35!==a.p_id&&36!==a.p_id||this.handleBtns.push(a))}}catch(t){e=!0,i=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw i}}},pageOnChange:function(t){this.pageNum=t,this.getNotifyList()},onPageSizeChange:function(t){this.pageNum=1,this.pageSize=t,this.getNotifyList()},searchKeyChange:function(){this.nm_title="",this.nm_isdraft=null}},mounted:function(){this.getPermissionBtns(),this.getNotifyList(),this.header={authorization:Object(l["i"])()},this.quill=this.$refs.myQuillEditor.quill},watch:{showModal:function(t){t||(this.nmTitle="",this.nmKeys="",this.nmContent="")}}},d=c,u=(i("a6ca"),i("2877")),h=Object(u["a"])(d,n,o,!1,null,null,null);h.options.__file="notifyMessage.vue";e["default"]=h.exports},a6ca:function(t,e,i){"use strict";var n=i("08f3"),o=i.n(n);o.a},ebad:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"quill-editor"},[t._t("toolbar"),i("div",{ref:"editor"})],2)},o=[],a=i("9339"),s=i.n(a),l={theme:"snow",boundary:document.body,modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},placeholder:"Insert text here ...",readOnly:!1};const r=window.Quill||s.a;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const i=Object(t);for(let n=1;n<arguments.length;n++){const t=arguments[n];if(null!=t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},writable:!0,configurable:!0});var c={name:"quill-editor",data(){return{_options:{},_content:"",defaultOptions:l}},props:{content:String,value:String,disabled:{type:Boolean,default:!1},options:{type:Object,required:!1,default:()=>({})},globalOptions:{type:Object,required:!1,default:()=>({})}},mounted(){this.initialize()},beforeDestroy(){this.quill=null,delete this.quill},methods:{initialize(){this.$el&&(this._options=Object.assign({},this.defaultOptions,this.globalOptions,this.options),this.quill=new r(this.$refs.editor,this._options),this.quill.enable(!1),(this.value||this.content)&&this.quill.pasteHTML(this.value||this.content),this.disabled||this.quill.enable(!0),this.quill.on("selection-change",t=>{t?this.$emit("focus",this.quill):this.$emit("blur",this.quill)}),this.quill.on("text-change",(t,e,i)=>{let n=this.$refs.editor.children[0].innerHTML;const o=this.quill,a=this.quill.getText();"<p><br></p>"===n&&(n=""),this._content=n,this.$emit("input",this._content),this.$emit("change",{html:n,text:a,quill:o})}),this.$emit("ready",this.quill))}},watch:{content(t,e){this.quill&&(t&&t!==this._content?(this._content=t,this.quill.pasteHTML(t)):t||this.quill.setText(""))},value(t,e){this.quill&&(t&&t!==this._content?(this._content=t,this.quill.pasteHTML(t)):t||this.quill.setText(""))},disabled(t,e){this.quill&&this.quill.enable(!t)}}},d=c,u=i("2877"),h=Object(u["a"])(d,n,o,!1,null,null,null);h.options.__file="editor.vue";e["a"]=h.exports}}]);