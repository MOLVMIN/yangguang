(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f71"],{"3bd3":function(t,e,o){"use strict";var a=o("7068"),i=o.n(a);i.a},"3fce":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("Card",[o("div",{staticClass:"search-con search-con-top"},[o("Select",{staticClass:"search-col",attrs:{placeholder:"请选择搜索字段",clearable:""},on:{"on-clear":t.searchKeyChange,"on-change":t.searchKeyChange},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}},t._l([{key:"role_name",title:"角色名称"}],function(e){return o("Option",{key:"search-col-"+e.key,attrs:{value:e.key}},[t._v(t._s(e.title))])})),"role_name"===t.searchKey?o("Input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"请输入角色名称关键字搜索"},model:{value:t.role_name,callback:function(e){t.role_name=e},expression:"role_name"}}):t._e(),o("Button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.getRoleList}},[t._v("搜索")]),t._l(t.permissionBtns,function(e){return 92===e.p_id?o("Button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("添加角色")]):t._e()}),o("Button",{staticClass:"add-btn",staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:t.allotEvent}},[t._v("角色权限分配")])],2),o("Table",{ref:"tablesMain",attrs:{data:t.tableData,columns:t.columns}}),o("Page",{staticClass:"page",attrs:{total:t.total,"page-size":t.pageSize,"show-sizer":"","show-elevator":"","prev-text":"上一页","next-text":"下一页"},on:{"on-change":t.pageOnChange,"on-page-size-change":t.onPageSizeChange}})],1),o("Modal",{attrs:{width:"800","mask-closable":!1},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[o("p",{staticStyle:{color:"#2d8cf0"},attrs:{slot:"header"},slot:"header"},[o("span",[t._v(t._s(t.modalTitle))])]),o("Form",[o("FormItem",[o("label",[t._v("角色名称：")]),o("Input",{attrs:{disabled:t.isView,placeholder:"请输入角色名称"},model:{value:t.roleName,callback:function(e){t.roleName=e},expression:"roleName"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[t.isView||t.isEdit?t._e():o("Button",{attrs:{type:"info",size:"large"},on:{click:t.addRole}},[t._v("保存")]),t.isEdit?o("Button",{attrs:{type:"success",size:"large"},on:{click:t.editRole}},[t._v("修改")]):t._e()],1)],1),o("Modal",{attrs:{width:"400","mask-closable":!1},model:{value:t.showAllotModal,callback:function(e){t.showAllotModal=e},expression:"showAllotModal"}},[o("p",{staticStyle:{color:"#2d8cf0"},attrs:{slot:"header"},slot:"header"},[o("span",[t._v("权限分配")])]),o("Form",[o("FormItem",[o("label",[t._v("角色名称：")]),o("Select",{on:{"on-change":t.getAllotEntity},model:{value:t.allotId,callback:function(e){t.allotId=e},expression:"allotId"}},t._l(t.tableData,function(e){return o("Option",{attrs:{value:e.role_id}},[t._v(t._s(e.role_name))])}))],1),o("Tree",{attrs:{data:t.permissionArray,multiple:""},on:{"on-select-change":t.onCheckSelect}})],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"info",size:"large"},on:{click:t.allotPermission}},[t._v("保存")])],1)],1)],1)},i=[],s=(o("ac4d"),o("8a81"),o("ac6a"),o("66df")),n=o("88ec"),l={name:"role",data:function(){var t=this;return{columns:[{title:"编号",align:"center",key:"role_id",sortable:!0},{title:"角色名称",align:"center",key:"role_name"},{title:"角色状态",align:"center",key:"data_level",render:function(t,e){return 1==e.row.data_level?t("div","正常"):5==e.row.data_level?t("div","已删除"):void 0}},{title:"操作",key:"handle",align:"center",render:function(e,o){for(var a=[],i=function(){var i=t.handleBtns[s];93===i.p_id?a.push(e("Button",{props:{type:"primary",size:"small",disabled:5===o.row.data_level},style:{margin:"2px"},on:{click:function(){t.editId=o.row.role_id,t.showOneRole(t.showOneRolePath,o.row.role_id),t.showModal=!0,t.modalTitle="角色信息修改",t.isView=!1,t.isEdit=!0}}},"修改")):94===i.p_id?a.push(e("Button",{props:{type:"info",size:"small"},style:{margin:"2px"},on:{click:function(){t.showOneRole(i.p_path,o.row.role_id),t.modalTitle="角色信息查看",t.showModal=!0,t.isView=!0,t.isEdit=!1}}},"查看")):95===i.p_id?a.push(e("Button",{props:{type:"error",size:"small",disabled:5===o.row.data_level},style:{margin:"2px"},on:{click:function(){t.deleteRole(i.p_path,o.row.role_id)}}},"删除")):96===i.p_id&&a.push(e("Button",{props:{type:"warning",size:"small",disabled:1===o.row.data_level},style:{margin:"2px"},on:{click:function(){t.restoreRole(i.p_path,o.row.role_id)}}},"恢复"))},s=0;s<t.handleBtns.length;s++)i();return e("div",a)}}],tableData:[],searchValue:"",searchKey:"",roleName:"",showModal:!1,showAllotModal:!1,roleId:"",isView:!1,isEdit:!1,permissionBtns:[],handleBtns:[],permissionIds:[],permissionArray:[],allotId:"",total:0,pageSize:10,pageNum:1,getListPath:"",showOneRolePath:"",modalTitle:"",editId:""}},methods:{handleAdd:function(){this.showModal=!0},handleClear:function(t){""===t.target.value&&(this.insideTableData=this.value)},addRole:function(){var t=this;s["a"].request({url:"admin/settings/role/addEntity.do",data:{role_name:this.roleName},method:"post"}).then(function(e){200===e.data.code?(t.getRoleList(),t.showModal=!1,t.$Notice.success({title:"新增成功"})):t.$Notice.error({title:e.data.msg})})},editRole:function(){var t=this;s["a"].request({url:"admin/settings/role/editEntity.do",data:{role_id:t.editId,role_name:t.roleName},method:"post"}).then(function(e){200===e.data.code?(t.getRoleList(),t.showModal=!1,t.$Notice.success({title:"修改角色信息成功"})):t.$Notice.error({title:e.data.msg})})},deleteRole:function(t,e){var o=this;o.$Modal.confirm({title:"提示",content:"确认删除角色信息？",onOk:function(){s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200==t.data.code?(o.$Notice.success({title:"角色信息删除成功"}),o.getRoleList()):o.$Notice.error({title:t.data.msg})})}})},restoreRole:function(t,e){var o=this;this.$Modal.confirm({title:"提示",content:"确认恢复角色信息？",onOk:function(){var a=this;s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){200==t.data.code?(a.$Notice.success({title:"角色信息恢复成功"}),o.getRoleList()):a.$Notice.error({title:t.data.msg})})}})},showOneRole:function(t,e){var o=this,a=this;s["a"].request({url:t,data:{entityId:e},method:"post"}).then(function(t){console.log(t),200===t.status?o.roleName=t.data.content.role_name:a.$Notice.error({title:t.data.msg})})},getRoleList:function(){var t=this;s["a"].request({url:t.getListPath,data:{pageNum:t.pageNum,pageSize:t.pageSize,name:t.role_name},method:"post"}).then(function(e){if(200===e.status){t.tableData=[],t.total=e.data.content.total;for(var o=0;o<e.data.content.list.length;o++)t.tableData.push(e.data.content.list[o])}})},getPermissionBtns:function(){this.permissionBtns=[];var t=!0,e=!1,o=void 0;try{for(var a,i=n["a"].permission[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;s.p_fid===this.$route.meta.id&&(this.permissionBtns.push(s),91===s.p_id&&(this.getListPath=s.p_path),94===s.p_id&&(this.showOneRolePath=s.p_path),93!==s.p_id&&94!==s.p_id&&95!==s.p_id&&96!==s.p_id||this.handleBtns.push(s))}}catch(t){e=!0,o=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw o}}},getAllotEntity:function(t){var e=this;s["a"].request({url:"admin/settings/role/allotEntity.do?roleId="+t,method:"get"}).then(function(t){for(var o in e.permissionArray=t.data.content.permissions,t.data.content.rolePermissions)for(var a in e.permissionIds.push(t.data.content.rolePermissions[o].p_id),e.permissionArray)t.data.content.rolePermissions[o].p_id===e.permissionArray[a].p_id&&(e.permissionArray[a].selected=!0);e.permissionArray=e.getPermissionArray(0,e.permissionArray)})},allotEvent:function(){this.showAllotModal=!0},allotPermission:function(){var t=this;t.$Modal.confirm({title:"提示",content:"确认分配权限？",onOk:function(){s["a"].request({url:"admin/settings/role/allotEntity.do",data:{roleId:t.allotId,permissionIds:t.permissionIds.join(",")},method:"post"}).then(function(e){200===e.status?t.$Notice.success({title:"角色权限分配成功"}):t.$Notice.error({title:e.data.msg})})}})},getPermissionArray:function(t,e){var o=this.getPermissionParentArray(t,e);if(o.length>0)for(var a in o)o[a].children=this.getPermissionArray(o[a].p_id,e);return o},getPermissionParentArray:function(t,e){var o=new Array;for(var a in e)e[a].p_fid===t&&o.push({p_id:e[a].p_id,p_fid:e[a].p_fid,title:e[a].p_name,selected:e[a].selected});return o},getPermissionIds:function(){},pageOnChange:function(t){this.pageNum=t,this.getRoleList()},onPageSizeChange:function(t){this.pageNum=1,this.pageSize=t,this.getRoleList()},onCheckSelect:function(t){for(var e in console.log(t),this.permissionIds=[],t)this.permissionIds.push(t[e].p_id);console.log(this.permissionIds)}},mounted:function(){this.getPermissionBtns(),this.getRoleList()},watch:{showModal:function(t){t||(this.roleName="",this.isEdit=!1,this.isView=!1)}}},r=l,d=(o("3bd3"),o("2877")),c=Object(d["a"])(r,a,i,!1,null,null,null);c.options.__file="role.vue";e["default"]=c.exports},7068:function(t,e,o){}}]);